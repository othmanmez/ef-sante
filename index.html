<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EF HEALTH - Multiplayer Health Quiz</title>
    <link rel="stylesheet" href="public/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="logo">EF HEALTH</h1>
            <p class="subtitle">Multiplayer Health Quiz</p>
        </header>

        <main class="main-content">
            <div class="welcome-card">
                <div class="card-header">
                    <div class="health-icon">üíö</div>
                    <h2>Welcome to EF HEALTH</h2>
                    <p>Discover your health score by answering 9 questions about your lifestyle habits</p>
                </div>

                <form id="joinForm" class="join-form">
                    <div class="input-group">
                        <label for="playerName">Your name</label>
                        <input type="text" id="playerName" name="playerName" placeholder="Enter your name" required>
                    </div>

                    <div class="input-group">
                        <label for="gameCode">Game code</label>
                        <input type="text" id="gameCode" name="gameCode" placeholder="Enter the game code" required>
                        <small>Ask the game organizer for the code</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="join-btn">
                            <span>Join the game</span>
                            <div class="btn-icon">üöÄ</div>
                        </button>
                        
                        <div class="divider">
                            <span>or</span>
                        </div>
                        
                        <button type="button" id="createGameBtn" class="create-btn">
                            <span>Create a new game</span>
                            <div class="btn-icon">üé≤</div>
                        </button>
                    </div>
                </form>

                <!-- Game creation section -->
                <div id="createGameSection" class="create-game-section" style="display: none;">
                    <div class="create-form">
                        <div class="form-header">
                            <h3>Create a new game</h3>
                            <button type="button" id="backToJoinBtn" class="back-btn">‚Üê Back</button>
                        </div>
                        
                        <div class="input-group">
                            <label for="creatorName">Your name</label>
                            <input type="text" id="creatorName" name="creatorName" placeholder="Enter your name" required>
                        </div>

                        <div class="input-group">
                            <label for="gameName">Game name (optional)</label>
                            <input type="text" id="gameName" name="gameName" placeholder="Ex: January 15th session">
                        </div>

                        <button type="button" id="generateCodeBtn" class="generate-btn">
                            <span>Generate game code</span>
                            <div class="btn-icon">üé≤</div>
                        </button>
                    </div>

                    <!-- Generated code -->
                    <div id="generatedCodeSection" class="generated-code-section" style="display: none;">
                        <div class="code-display">
                            <h4>üéâ Game created successfully!</h4>
                            <div class="code-box">
                                <span id="generatedCode" class="code-text"></span>
                                <button id="copyCodeBtn" class="copy-btn">üìã</button>
                            </div>
                            <p class="code-info">Share this code with your friends so they can join the game</p>
                        </div>

                        <div class="code-actions">
                            <button id="startGameBtn" class="btn-primary">
                                üöÄ Start the game
                            </button>
                            <button id="shareCodeBtn" class="btn-secondary">
                                üì§ Share the code
                            </button>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>How it works</h3>
                    <div class="steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <p>Enter your name and the game code</p>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <p>Answer the 9 questions at your own pace</p>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <p>Discover your health score and compare with others</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="features">
                <div class="feature">
                    <div class="feature-icon">üë•</div>
                    <h4>Multiplayer</h4>
                    <p>Play with your friends in real-time</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">‚ö°</div>
                    <h4>Real-time</h4>
                    <p>Instant synchronization</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üìä</div>
                    <h4>Personalized score</h4>
                    <p>Analysis of your health habits</p>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>¬© 2025 EF HEALTH - Multiplayer Health Quiz</p>
        </footer>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentGameCode = null;
        
        // Gestionnaires d'√©v√©nements Socket.io
        socket.on('game-created', function(data) {
            console.log('Partie cr√©√©e:', data);
            // Rediriger vers le quiz
            window.location.href = '/quiz';
        });
        
        socket.on('game-joined', function(data) {
            console.log('Partie rejointe:', data);
            // Rediriger vers le quiz
            window.location.href = '/quiz';
        });
        
        socket.on('game-error', function(data) {
            console.error('Erreur:', data.message);
            alert('Erreur: ' + data.message);
        });
        
        socket.on('connect', function() {
            console.log('Connect√© au serveur');
        });
        
        socket.on('disconnect', function() {
            console.log('D√©connect√© du serveur');
        });
        
        // Formulaire de connexion
        document.getElementById('joinForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const playerName = document.getElementById('playerName').value.trim();
            const gameCode = document.getElementById('gameCode').value.trim();
            
            if (playerName && gameCode) {
                // Stocker les donn√©es dans le localStorage
                localStorage.setItem('playerName', playerName);
                localStorage.setItem('gameCode', gameCode);
                
                // Rejoindre la partie c√¥t√© serveur
                socket.emit('join-game', {
                    playerName: playerName,
                    gameCode: gameCode
                });
            }
        });
        
        // Bouton pour cr√©er une partie
        document.getElementById('createGameBtn').addEventListener('click', function() {
            // Masquer le formulaire de connexion
            document.querySelector('.join-form').style.display = 'none';
            // Afficher le formulaire de cr√©ation
            const createSection = document.getElementById('createGameSection');
            createSection.style.display = 'block';
            // Ajouter la classe show pour l'animation
            setTimeout(() => {
                createSection.classList.add('show');
            }, 100);
        });
        
        // G√©n√©rer un code de partie
        document.getElementById('generateCodeBtn').addEventListener('click', function() {
            const creatorName = document.getElementById('creatorName').value.trim();
            const gameName = document.getElementById('gameName').value.trim();
            
            if (creatorName) {
                // G√©n√©rer un code al√©atoire
                const code = generateRandomCode();
                currentGameCode = code;
                
                // Afficher le code g√©n√©r√©
                document.getElementById('generatedCode').textContent = code;
                document.getElementById('generatedCodeSection').style.display = 'block';
                
                // Stocker les donn√©es
                localStorage.setItem('playerName', creatorName);
                localStorage.setItem('gameCode', code);
                
                // Cr√©er la partie c√¥t√© serveur
                socket.emit('create-game', {
                    code: code,
                    name: gameName || `Partie de ${creatorName}`,
                    creator: creatorName
                });
                
                // Animation
                const section = document.getElementById('generatedCodeSection');
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, 100);
            }
        });
        
        // Copier le code
        document.getElementById('copyCodeBtn').addEventListener('click', function() {
            navigator.clipboard.writeText(currentGameCode).then(() => {
                this.innerHTML = '‚úÖ';
                setTimeout(() => {
                    this.innerHTML = 'üìã';
                }, 2000);
            });
        });
        
        // D√©marrer la partie
        document.getElementById('startGameBtn').addEventListener('click', function() {
            if (currentGameCode) {
                window.location.href = '/quiz';
            }
        });
        
        // Share the code
        document.getElementById('shareCodeBtn').addEventListener('click', function() {
            if (navigator.share) {
                navigator.share({
                    title: 'EF HEALTH - Game Code',
                    text: `Join my EF HEALTH game! Code: ${currentGameCode}`,
                    url: window.location.origin
                });
            } else {
                const text = `Join my EF HEALTH game! Code: ${currentGameCode}\nLink: ${window.location.origin}`;
                navigator.clipboard.writeText(text).then(() => {
                    alert('Link copied to clipboard!');
                });
            }
        });
        
        // Bouton retour
        document.getElementById('backToJoinBtn').addEventListener('click', function() {
            // Masquer la section de cr√©ation
            const createSection = document.getElementById('createGameSection');
            createSection.classList.remove('show');
            setTimeout(() => {
                createSection.style.display = 'none';
            }, 300);
            // Afficher le formulaire de connexion
            document.querySelector('.join-form').style.display = 'block';
        });
        
        // G√©n√©rer un code al√©atoire
        function generateRandomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
 
        // Animation d'entr√©e
        window.addEventListener('load', function() {
            document.querySelector('.welcome-card').style.opacity = '1';
            document.querySelector('.welcome-card').style.transform = 'translateY(0)';
        });
    </script>
</body>
</html>
